## 报错信息
###  ros2 CLI
![[Pasted image 20260202152728.png]]
```
enine@enine-Precision-3680:~/VR_teleop$ ros2 node list
Traceback (most recent call last):
  File "/opt/ros/humble/bin/ros2", line 33, in <module>
    sys.exit(load_entry_point('ros2cli==0.18.15', 'console_scripts', 'ros2')())
  File "/opt/ros/humble/lib/python3.10/site-packages/ros2cli/cli.py", line 91, in main
    rc = extension.main(parser=parser, args=args)
  File "/opt/ros/humble/lib/python3.10/site-packages/ros2node/command/node.py", line 37, in main
    return extension.main(args=args)
  File "/opt/ros/humble/lib/python3.10/site-packages/ros2node/verb/list.py", line 38, in main
    node_names = get_node_names(node=node, include_hidden_nodes=args.all)
  File "/opt/ros/humble/lib/python3.10/site-packages/ros2node/api/__init__.py", line 60, in get_node_names
    node_names_and_namespaces = node.get_node_names_and_namespaces()
  File "/usr/lib/python3.10/xmlrpc/client.py", line 1122, in __call__
    return self.__send(self.__name, args)
  File "/usr/lib/python3.10/xmlrpc/client.py", line 1464, in __request
    response = self.__transport.request(
  File "/usr/lib/python3.10/xmlrpc/client.py", line 1166, in request
    return self.single_request(host, handler, request_body, verbose)
  File "/usr/lib/python3.10/xmlrpc/client.py", line 1182, in single_request
    return self.parse_response(resp)
  File "/usr/lib/python3.10/xmlrpc/client.py", line 1354, in parse_response
    return u.close()
  File "/usr/lib/python3.10/xmlrpc/client.py", line 668, in close
    raise Fault(**self._stack[0])
xmlrpc.client.Fault: <Fault 1: "<class 'rclpy._rclpy_pybind11.RCLError'>:Failed to get node names: empty node name returned by the RMW layer, at ./src/rcl/graph.c:360">
```
### 参数值未设置


```
[servo_node-7] [WARN] [1769595058.968534444] [moveit_servo]: Command type has not been set, cannot accept input
```

### 重名节点
![[Pasted image 20260202153543.png]]

```
root@asus-MINIPC-PN64:~/ros2_ws# ros2 node list
WARNING: Be aware that there are nodes in the graph that share an exact name, which can have unintended side effects.
/action_server
/controller_manager
/fr3_arm_controller
/franka_robot_state_broadcaster
/frankahardwareinterface
/joint_state_broadcaster
/moveit_servo
/moveit_servo
/moveit_servo/moveit_servo
/moveit_servo_private_94770922598720
/robot_state_publisher
/robotiq_gripper
/robotiq_gripper_controller
/service_server
/transform_listener_impl_5631933d3390
root@asus-MINIPC-PN64:~/ros2_ws#
```

### 话题列表（现场快照）
```
root@asus-MINIPC-PN64:~/ros2_ws# ros2 topic list
/attached_collision_object
/collision_object
/controller_manager/activity
/controller_manager/introspection_data/full
/controller_manager/introspection_data/names
/controller_manager/introspection_data/values
/diagnostics
/dynamic_joint_states
/fr3_arm_controller/controller_state
/fr3_arm_controller/joint_trajectory
/fr3_arm_controller/transition_event
/franka_robot_state_broadcaster/current_pose
/franka_robot_state_broadcaster/desired_end_effector_twist
/franka_robot_state_broadcaster/desired_joint_states
/franka_robot_state_broadcaster/external_joint_torques
/franka_robot_state_broadcaster/external_wrench_in_base_frame
/franka_robot_state_broadcaster/external_wrench_in_stiffness_frame
/franka_robot_state_broadcaster/last_desired_pose
/franka_robot_state_broadcaster/measured_joint_states
/franka_robot_state_broadcaster/robot_state
/franka_robot_state_broadcaster/transition_event
/joint_state_broadcaster/transition_event
/joint_states
/moveit_servo/delta_joint_cmds
/moveit_servo/delta_twist_cmds
/moveit_servo/pose_target_cmds
/moveit_servo/publish_planning_scene
/moveit_servo/status
/parameter_events
/planning_scene
/planning_scene_world
/robot_description
/robotiq_gripper_controller/transition_event
/rosout
/tf
/tf_static
/vr/right_controller/joystick_y
/vr/right_controller/pose_hmd
/vr/right_controller/trigger
```

## 当前场景
- 两台机子：一边 Humble，一边 Jazzy，且都用 CycloneDDS（cyc）。
- 现象：MoveIt 一启动，VR 端就报错。
- 跨发行版本身不必然导致空节点名，但异常节点名会触发。
## 控制链路图
![[Pasted image 20260202154324.png]]

![[Pasted image 20260202155756.png]]


## 核心结论
![[Pasted image 20260202153656.png]]
- RMW 层返回了空节点名，`ros2 node list` 解析失败。
- 不是 ros2 CLI 的 Python 逻辑错误，而是底层 RMW/节点注册数据异常。
- 最常见原因：某个进程注册了非法/异常节点名。

## 先做的定位步骤
1) 隔离验证：临时把 VR 或 MoveIt 端的 `ROS_DOMAIN_ID` 改成不同值，再启动 MoveIt。若错误消失，说明是跨机 DDS 数据触发。
2) MoveIt 本机执行 `ros2 node list`，看是否同样报错，判断异常是否来自 MoveIt 侧。
3) MoveIt 启动时加详细日志（如 `--ros-args --log-level debug`），观察是否出现空/非法节点名相关日志。
4) 检查 MoveIt 相关 launch/参数里是否有 `name` 为空或包含非法字符。


## 排查方向
- VR 和 MoveIt 都启动了 start servo：建议只保留一端。
- 若机械臂不动，检查数据流：
  - `/moveit_servo/delta_twist_cmds`
  - `/fr3_arm_controller/joint_trajectory`
- 查看话题信息：`ros2 topic info`
- 控制器是否加载/激活：`ros2 control list_controllers`
- 检查 ROS 通信：同一个 `ROS_DOMAIN_ID`、中间件一致、`cyclonedds.xml` 配置一致。
- 跨发行版时可临时使用：
```
ros2 node list --no-daemon
```
